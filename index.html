<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.css"
        integrity="sha384-zTROYFVGOfTw7JV7KUu8udsvW2fx4lWOsCEDqhBreBwlHI4ioVRtmIvEThzJHGET" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.js"
        integrity="sha384-GxNFqL3r9uRJQhR+47eDxuPoNE7yLftQM8LcxzgS4HT73tp970WS/wV5p8UzCOmb"
        crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/contrib/auto-render.min.js"
        integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"
        crossorigin="anonymous"></script>
    <script type="module">
        import renderMathInElement from "https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/contrib/auto-render.mjs";
    </script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/protonater/ckeditor-draft/public/auto/js/main.min.js"></script>
    <!-- <script src="./tinymce/tinymce.min.js"></script> -->
    <!-- <link href="./clone/public/auto/css/solutions.min.css" rel="Stylesheet" type="text/css" /> -->
    <!-- <script src="./clone/public/auto/js/solutions.min.js"></script> -->
    <script
        src="https://cdn.tiny.cloud/1/olayhq3egaat8n1xm0zjleclyytx387nwra71on76g6y45qp/tinymce/5/tinymce.min.js"></script>
    <script>
        var dialogConfig = {
            title: "Dialog Demo",
            url: "public/html/mathEditor.html",
            buttons: [
                {
                    type: "custom",
                    name: "inline-insert",
                    text: "inline-insert",
                    primary: true,
                    align: "end"
                },
                {
                    type: "custom",
                    name: "block-insert",
                    text: "block-insert",
                    align: "end"
                },
                {
                    type: "cancel",
                    name: "cancel",
                    text: "Cancel"
                }
            ],
            height: 400,
            width: 700,
            onAction: function (instance, trigger) {
                debugger;
                if (trigger.name === "block-insert") {
                    instance.sendMessage({
                        mceAction: "customBlockInsert"
                    });
                } else if (trigger.name === "inline-insert") {
                    instance.sendMessage({
                        mceAction: "customInlineInsert"
                    });
                }
            }
        };
        let config = {
            selector: 'textarea',  // change this value according to your HTML
            plugins: ['advlist autolink lists link image charmap print preview anchor',
                'searchreplace visualblocks code fullscreen',
                'insertdatetime media table paste code help wordcount'],
            toolbar: 'undo redo | formatselect | ' +
                'bold italic backcolor | alignleft aligncenter ' +
                'alignright alignjustify | bullist numlist outdent indent | ' +
                'removeformat | iframe help',
            height: 500,
            advlist_bullet_styles: 'square',
            advlist_number_styles: 'lower-alpha,lower-roman,upper-alpha,upper-roman',
            content_css: 'https://cdn.jsdelivr.net/gh/protonater/ckeditor-draft/public/auto/css/solution.min.css',
            setup: function (editor) {
                editor.ui.registry.addButton("iframe", {
                    text: "Math Formula",
                    icon: "frame",
                    onAction: () => {
                        _api = editor.windowManager.openUrl(dialogConfig);
                    }
                });

                editor.addCommand("iframeCommand", function (ui, value) {
                    // const el = document.getElementById("tex");
                    // el.append(value.name);
                    // katex.render(value.name, el);
                    debugger;
                    if (value.type === "block") {
                        editor.insertContent(
                            `&nbsp;<span id="block-math" class="mathquill-input mathquill-editable" rel="tooltip" title="">${value.name}</span>&nbsp;`
                        );
                    } else {
                        editor.insertContent(
                            `&nbsp;<span id="inline-math" class="mathquill-input mathquill-editable" rel="tooltip" title="">${value.name}</span>&nbsp;`
                        );
                    }
                    $("#code-input").mathquill();
                });
            }
        };

        tinymce.init(config);
    </script>
</head>

<body>
    <div style="display: block;" id="tex"></div>
    <textarea>Next, use our Get Started docs to setup Tiny!</textarea>
</body>

</html>